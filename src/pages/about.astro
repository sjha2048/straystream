---
import Base from '@/layouts/Base.astro';
import fs from 'node:fs';
import path from 'node:path';
import Markdoc from '@markdoc/markdoc';

// Read about page content directly from file
let title = 'About';
let subtitle = 'A bit about me and what I do';
let contentHtml = '';

try {
  const aboutPath = path.join(process.cwd(), 'src/content/pages/about/index.mdoc');
  const rawContent = fs.readFileSync(aboutPath, 'utf-8');

  // Parse frontmatter and content
  const frontmatterMatch = rawContent.match(/^---\n([\s\S]*?)\n---\n([\s\S]*)$/);
  if (frontmatterMatch) {
    const frontmatter = frontmatterMatch[1];
    const content = frontmatterMatch[2];

    // Extract title and subtitle from frontmatter
    const titleMatch = frontmatter.match(/title:\s*(.+)/);
    const subtitleMatch = frontmatter.match(/subtitle:\s*(.+)/);
    if (titleMatch) title = titleMatch[1].trim();
    if (subtitleMatch) subtitle = subtitleMatch[1].trim();

    // Render markdoc content
    const ast = Markdoc.parse(content);
    const transformed = Markdoc.transform(ast);
    contentHtml = Markdoc.renderers.html(transformed);
  }
} catch {
  // File doesn't exist yet
}
---

<Base title="About | straystream" description="Learn more about me and what I do">
  <article class="container-narrow py-16">
    <header class="mb-12">
      <h1 class="text-4xl font-bold text-neutral-900 dark:text-neutral-100 tracking-tight">{title}</h1>
      {subtitle && <p class="mt-4 text-xl text-neutral-600 dark:text-neutral-400">{subtitle}</p>}
    </header>

    {contentHtml ? (
      <div class="prose prose-neutral dark:prose-invert max-w-none" set:html={contentHtml} />
    ) : (
      <div class="prose prose-neutral dark:prose-invert max-w-none">
        <p>
          More about me coming soon.
        </p>
      </div>
    )}
  </article>
</Base>
