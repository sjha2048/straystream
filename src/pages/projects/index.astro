---
import { getCollection } from 'astro:content';
import Base from '@/layouts/Base.astro';
import ProjectCard from '@/components/ProjectCard.astro';

let projects: any[] = [];
try {
  const allProjects = await getCollection('projects');
  projects = allProjects.sort((a, b) => {
    if (a.data.featured && !b.data.featured) return -1;
    if (!a.data.featured && b.data.featured) return 1;
    return a.data.title.localeCompare(b.data.title);
  });
} catch {
  // Collection empty or doesn't exist yet
}
---

<Base title="Projects | straystream" description="A collection of projects I've worked on">
  <section class="container-wide py-16">
    <header class="mb-12">
      <h1 class="text-4xl font-bold text-neutral-900 tracking-tight">Projects</h1>
      <p class="mt-4 text-xl text-neutral-600">Things I've built and worked on.</p>
    </header>

    {projects.length > 0 ? (
      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {projects.map((project) => (
          <ProjectCard
            title={project.data.title}
            slug={project.id.replace('/index', '')}
            tagline={project.data.tagline}
            techStack={project.data.techStack}
            projectLink={project.data.projectLink}
            coverImage={project.data.coverImage}
          />
        ))}
      </div>
    ) : (
      <p class="text-neutral-500">
        No projects yet. Check back soon.
      </p>
    )}
  </section>
</Base>
