---
import { getCollection, getEntry } from 'astro:content';
import Base from '@/layouts/Base.astro';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

const { project } = Astro.props;
const { Content } = await project.render();

const { title, tagline, techStack = [], projectLink, repoLink, coverImage } = project.data;
---

<Base
  title={`${title} | Projects | straystream`}
  description={tagline ?? `Project: ${title}`}
  image={coverImage ?? undefined}
>
  <article class="container-narrow py-16">
    <!-- Back link -->
    <a href="/projects" class="inline-flex items-center text-sm text-neutral-500 hover:text-neutral-900 transition-colors mb-8">
      &larr; All projects
    </a>

    <!-- Header -->
    <header class="mb-8">
      {coverImage && (
        <img
          src={coverImage}
          alt=""
          class="w-full aspect-video object-cover rounded-lg mb-8"
        />
      )}
      <h1 class="text-4xl font-bold text-neutral-900 tracking-tight">{title}</h1>
      {tagline && <p class="mt-2 text-xl text-neutral-600">{tagline}</p>}

      <!-- Tech stack -->
      {techStack.length > 0 && (
        <div class="mt-4 flex flex-wrap gap-2">
          {techStack.map((tech) => (
            <span class="px-3 py-1 text-sm bg-neutral-100 text-neutral-700 rounded-full">
              {tech}
            </span>
          ))}
        </div>
      )}

      <!-- Links -->
      <div class="mt-6 flex items-center gap-4">
        {projectLink && (
          <a
            href={projectLink}
            target="_blank"
            rel="noopener noreferrer"
            class="btn btn-primary"
          >
            View Live Site
          </a>
        )}
        {repoLink && (
          <a
            href={repoLink}
            target="_blank"
            rel="noopener noreferrer"
            class="btn btn-secondary"
          >
            View Source
          </a>
        )}
      </div>
    </header>

    <!-- Content -->
    <div class="prose prose-neutral max-w-none">
      <Content />
    </div>
  </article>
</Base>
